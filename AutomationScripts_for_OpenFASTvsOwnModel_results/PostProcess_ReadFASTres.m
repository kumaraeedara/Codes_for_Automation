%%  Kumara Raja E, 27-March-2022
% To read output file generated by OpenFAST
res_FAST_N1_N9 = readtable('Sim_01_outputN1_N9_12mps20RPM.out','FileType',"text",'HeaderLines',8,"ReadVariableNames",0);
res_FAST_01 = table2array(res_FAST_N1_N9);
res_FAST_N9_N17 = readtable('Sim_01_outputN9_N17_12mps20RPM.out','FileType',"text",'HeaderLines',8,"ReadVariableNames",0);
res_FAST_02 = table2array(res_FAST_N9_N17);

OutputList = split(["Time	Wind1VelX	Wind1VelY	Wind1VelZ	RotSpeed    BldPitch1	BldPitch2	BldPitch3	OoPDefl1	OoPDefl2	OoPDefl3	IPDefl1	IPDefl2	IPDefl3	TwstDefl1	TwstDefl2	TwstDefl3	RotThrust	LSShftFya	LSShftFza	LSSTipMya	LSSTipMza	RotTorq	RotPwr	TTDspFA	TTDspSS	TwHt1MLxt	TwHt1MLyt	TwHt1MLzt	TwHt2FLxt	TwHt2FLyt	TwHt2FLzt	TwHt1RPxi	TwHt1TPxi	TwHt1RDxt	TwHt1TDxt	TipDxc1	TipDyc1	TipDzc1	TipDxb1	TipDyb1	TipALxb1	TipALyb1	TipALzb1	TipRDxb1	TipRDyb1	TipRDzc1	TipClrnc1	TipDxc2	TipDyc2	TipDzc2	TipDxb2	TipDyb2	TipALxb2	TipALyb2	TipALzb2	TipRDxb2	TipRDyb2	TipRDzc2	TipClrnc2	TipDxc3	TipDyc3	TipDzc3	TipDxb3	TipDyb3	TipALxb3	TipALyb3	TipALzb3	TipRDxb3	TipRDyb3	TipRDzc3	TipClrnc3	LSSTipPxa	LSSTipVxa	LSSTipAxa	LSSGagPxa	LSSGagVxa	LSSGagAxa	HSShftV	HSShftA	YawPzn	YawVzn	YawAzn	YawBrTDxp	YawBrTDyp	YawBrTDzp	YawBrTDxt	YawBrTDyt	YawBrTDzt	YawBrTAxp	YawBrTAyp	YawBrTAzp	YawBrRDxt	YawBrRDyt	YawBrRDzt	YawBrRVxp	YawBrRVyp	YawBrRVzp	YawBrRAxp	YawBrRAyp	YawBrRAzp	RootFxc1	RootFyc1	RootFzc1	RootFxb1	RootFyb1	RootMxc1	RootMyc1	RootMzc1	RootMxb1	RootMyb1	RootFxc2	RootFyc2	RootFzc2	RootFxb2	RootFyb2	RootMxc2	RootMyc2	RootMzc2	RootMxb2	RootMyb2	RootFxc3	RootFyc3	RootFzc3	RootFxb3	RootFyb3	RootMxc3	RootMyc3	RootMzc3	RootMxb3	RootMyb3	LSShftFxa	LSShftFya	LSShftFza	LSShftFys	LSShftFzs	LSShftMxa	LSSTipMya	LSSTipMza	LSSTipMys	LSSTipMzs	RotPwr	HSShftTq	HSSBrTq	HSShftPwr	YawBrFxn	YawBrFyn	YawBrFzn	YawBrFxp	YawBrFyp	YawBrMxn	YawBrMyn	YawBrMzn	YawBrMxp	YawBrMyp	TwrBsFxt	TwrBsFyt	TwrBsFzt	TwrBsMxt	TwrBsMyt	TwrBsMzt	LSSGagVxa	B1N1DynP	B1N2DynP	B1N3DynP	B1N4DynP	B1N5DynP	B1N6DynP	B1N7DynP	B1N8DynP	B1N9DynP	B2N1DynP	B2N2DynP	B2N3DynP	B2N4DynP	B2N5DynP	B2N6DynP	B2N7DynP	B2N8DynP	B2N9DynP	B3N1DynP	B3N2DynP	B3N3DynP	B3N4DynP	B3N5DynP	B3N6DynP	B3N7DynP	B3N8DynP	B3N9DynP	B1N1Fl	B1N2Fl	B1N3Fl	B1N4Fl	B1N5Fl	B1N6Fl	B1N7Fl	B1N8Fl	B1N9Fl	B2N1Fl	B2N2Fl	B2N3Fl	B2N4Fl	B2N5Fl	B2N6Fl	B2N7Fl	B2N8Fl	B2N9Fl	B3N1Fl	B3N2Fl	B3N3Fl	B3N4Fl	B3N5Fl	B3N6Fl	B3N7Fl	B3N8Fl	B3N9Fl	B1N1Fd	B1N2Fd	B1N3Fd	B1N4Fd	B1N5Fd	B1N6Fd	B1N7Fd	B1N8Fd	B1N9Fd	B2N1Fd	B2N2Fd	B2N3Fd	B2N4Fd	B2N5Fd	B2N6Fd	B2N7Fd	B2N8Fd	B2N9Fd	B3N1Fd	B3N2Fd	B3N3Fd	B3N4Fd	B3N5Fd	B3N6Fd	B3N7Fd	B3N8Fd	B3N9Fd	B1N1Phi	B1N2Phi	B1N3Phi	B1N4Phi	B1N5Phi	B1N6Phi	B1N7Phi	B1N8Phi	B1N9Phi	B2N1Phi	B2N2Phi	B2N3Phi	B2N4Phi	B2N5Phi	B2N6Phi	B2N7Phi	B2N8Phi	B2N9Phi	B3N1Phi	B3N2Phi	B3N3Phi	B3N4Phi	B3N5Phi	B3N6Phi	B3N7Phi	B3N8Phi	B3N9Phi	B1N1Alpha	B1N2Alpha	B1N3Alpha	B1N4Alpha	B1N5Alpha	B1N6Alpha	B1N7Alpha	B1N8Alpha	B1N9Alpha	B2N1Alpha	B2N2Alpha	B2N3Alpha	B2N4Alpha	B2N5Alpha	B2N6Alpha	B2N7Alpha	B2N8Alpha	B2N9Alpha	B3N1Alpha	B3N2Alpha	B3N3Alpha	B3N4Alpha	B3N5Alpha	B3N6Alpha	B3N7Alpha	B3N8Alpha	B3N9Alpha	B1N1Fx	B1N2Fx	B1N3Fx	B1N4Fx	B1N5Fx	B1N6Fx	B1N7Fx	B1N8Fx	B1N9Fx	B2N1Fx	B2N2Fx	B2N3Fx	B2N4Fx	B2N5Fx	B2N6Fx	B2N7Fx	B2N8Fx	B2N9Fx	B3N1Fx	B3N2Fx	B3N3Fx	B3N4Fx	B3N5Fx	B3N6Fx	B3N7Fx	B3N8Fx	B3N9Fx	B1N1Fy	B1N2Fy	B1N3Fy	B1N4Fy	B1N5Fy	B1N6Fy	B1N7Fy	B1N8Fy	B1N9Fy	B2N1Fy	B2N2Fy	B2N3Fy	B2N4Fy	B2N5Fy	B2N6Fy	B2N7Fy	B2N8Fy	B2N9Fy	B3N1Fy	B3N2Fy	B3N3Fy	B3N4Fy	B3N5Fy	B3N6Fy	B3N7Fy	B3N8Fy	B3N9Fy	B1N1AxInd	B1N2AxInd	B1N3AxInd	B1N4AxInd	B1N5AxInd	B1N6AxInd	B1N7AxInd	B1N8AxInd	B1N9AxInd	B2N1AxInd	B2N2AxInd	B2N3AxInd	B2N4AxInd	B2N5AxInd	B2N6AxInd	B2N7AxInd	B2N8AxInd	B2N9AxInd	B3N1AxInd	B3N2AxInd	B3N3AxInd	B3N4AxInd	B3N5AxInd	B3N6AxInd	B3N7AxInd	B3N8AxInd	B3N9AxInd	B1N1TnInd	B1N2TnInd	B1N3TnInd	B1N4TnInd	B1N5TnInd	B1N6TnInd	B1N7TnInd	B1N8TnInd	B1N9TnInd	B2N1TnInd	B2N2TnInd	B2N3TnInd	B2N4TnInd	B2N5TnInd	B2N6TnInd	B2N7TnInd	B2N8TnInd	B2N9TnInd	B3N1TnInd	B3N2TnInd	B3N3TnInd	B3N4TnInd	B3N5TnInd	B3N6TnInd	B3N7TnInd	B3N8TnInd	B3N9TnInd	B1N1VUndx	B1N2VUndx	B1N3VUndx	B1N4VUndx	B1N5VUndx	B1N6VUndx	B1N7VUndx	B1N8VUndx	B1N9VUndx	B2N1VUndx	B2N2VUndx	B2N3VUndx	B2N4VUndx	B2N5VUndx	B2N6VUndx	B2N7VUndx	B2N8VUndx	B2N9VUndx	B3N1VUndx	B3N2VUndx	B3N3VUndx	B3N4VUndx	B3N5VUndx	B3N6VUndx	B3N7VUndx	B3N8VUndx	B3N9VUndx	RtSpeed	RtTSR	RtVAvgxh	RtVAvgyh	RtVAvgzh	RtSkew	RtAeroFxh	RtAeroFyh	RtAeroFzh	RtAeroMxh	RtAeroMyh	RtAeroMzh	RtAeroPwr	RtArea	RtAeroCp	RtAeroCq	RtAeroCt"]);

ind_B1N1Fl = find( strcmp( OutputList,'B1N1Fl' ) );
ind_B1N1Fd = find( strcmp( OutputList,'B1N1Fd' ) );
ind_B1N1AxInd = find( strcmp( OutputList,'B1N1AxInd' ) );
ind_B1N1TnInd = find( strcmp( OutputList,'B1N1TnInd' ) );
ind_AeroTorq = find ( strcmp ( OutputList,'RotTorq' ) );
ind_AeroThrust = find ( strcmp ( OutputList,'RotThrust' ) );
ind_AoA = find( strcmp( OutputList,'B1N1Alpha' ) );
ind_InflowAng = find( strcmp( OutputList,'B1N1Phi' ) );

force_lift_FAST_01 = res_FAST_01(end, ind_B1N1Fl:ind_B1N1Fl+8);    % per unit length( N1 - N9 )
force_drag_FAST_01 = res_FAST_01(end, ind_B1N1Fd:ind_B1N1Fd+8);    % per unit length( N1 - N9)
AxInd_B1_FAST_01 = res_FAST_01(end,   ind_B1N1AxInd:ind_B1N1AxInd+8);    % per unit length( N1 - N9)
TanInd_B1_FAST_01 = res_FAST_01(end,  ind_B1N1TnInd:ind_B1N1TnInd+8);    % per unit length( N1 - N9)
angle_AoA_FAST_01 = res_FAST_01(end, ind_AoA:ind_AoA+8);    % (N1 - N9)
angle_inflow_FAST_01 = res_FAST_01(end, ind_InflowAng:ind_InflowAng+8); % (N1 - N9)

force_lift_FAST_02 = res_FAST_02(end, ind_B1N1Fl+1:ind_B1N1Fl+8);    % per unit length( N9 - N17)
force_drag_FAST_02 = res_FAST_02(end, ind_B1N1Fd+1:ind_B1N1Fd+8);    % per unit length( N9 - N17)
AxInd_B1_FAST_02 = res_FAST_02(end,   ind_B1N1AxInd+1:ind_B1N1AxInd+8);    % per unit length( N9 - N17)
TanInd_B1_FAST_02 = res_FAST_02(end,  ind_B1N1TnInd+1:ind_B1N1TnInd+8);    % per unit length( N9 - N17)
angle_AoA_FAST_02 = res_FAST_02(end, ind_AoA+1:ind_AoA+8);    % deg
angle_inflow_FAST_02 = res_FAST_02(end, ind_InflowAng+1:ind_InflowAng+8); % deg

force_lift_FAST = [force_lift_FAST_01 force_lift_FAST_02];  % per unit length
force_drag_FAST = [force_drag_FAST_01 force_drag_FAST_02];  % per unit length
AxInd_B1_FAST = [AxInd_B1_FAST_01 AxInd_B1_FAST_02];    % (N1 - N9)     
TanInd_B1_FAST = [TanInd_B1_FAST_01 TanInd_B1_FAST_02]; % (N1 - N9)  
angle_AoA_FAST = [angle_AoA_FAST_01 angle_AoA_FAST_02]; % (deg)
angle_inflow_FAST = [angle_inflow_FAST_01 angle_inflow_FAST_02];
Torque_aero_FAST = 1000*res_FAST_02(end, ind_AeroTorq);    % N-m
Thrust_aero_FAST = 1000*res_FAST_02(end, ind_AeroThrust);  % N

%% Plots
figure
scatter([1:17],angle_AoA_FAST,'LineWidth',1.5)
hold on
scatter([1:17],rad2deg(1)*angle_AoA_airfoil_B1(end,:),'x','LineWidth',1.5,'MarkerEdgeColor','#A2142F')
xlabel('Blade section')
ylabel('Angle of attack (deg)')
xticks([1:2:17])
set(gca,'FontSize',14)
legend("OpenFAST","In-house code")

figure
scatter([1:17],angle_inflow_FAST(end,:),'LineWidth',1.5)
hold on
scatter([1:17],rad2deg(1)*angle_inflow_airfoil_B1(end,:),'x','LineWidth',1.5,'MarkerEdgeColor','#A2142F')
xlabel('Blade section')
ylabel('Inflow angle(deg)')
xticks([1:2:17])
set(gca,'FontSize',14)
legend("OpenFAST","In-house code")

figure
scatter([1:17],AxInd_B1_FAST,'LineWidth',1.5)
hold on
scatter([1:17],AxIndFactor_B1(end,:),'x','LineWidth',1.5,'MarkerEdgeColor','#A2142F')
xlabel('Blade section')
ylabel('Axial induction factor')
xticks([1:2:17])
set(gca,'FontSize',14)
legend("OpenFAST","In-house code")

figure
scatter([1:17],TanInd_B1_FAST,'LineWidth',1.5)
hold on
scatter([1:17],TanIndFactor_B1(end,:),'x','LineWidth',1.5,'MarkerEdgeColor','#A2142F')
xlabel('Blade section')
ylabel('Tangential induction factor')
xlim auto
xticks([1:2:17])
set(gca,'FontSize',14)
legend("OpenFAST","In-house code")

figure
scatter([1:17],force_lift_FAST,'LineWidth',1.5)
hold on
scatter([1:17],force_lift_airfoil_B1(end,:),'x','LineWidth',1.5,'MarkerEdgeColor','#A2142F')
xlabel('Blade section')
ylabel('Lift force per unit length (N/mm)')
xlim auto
xticks([1:2:17])
set(gca,'FontSize',14)
legend("OpenFAST","In-house code")

figure
scatter([1:17],force_drag_FAST,'LineWidth',1.5)
hold on
scatter([1:17],force_drag_airfoil_B1(end,:),'x','LineWidth',1.5,'MarkerEdgeColor','#A2142F')
xlabel('Blade section')
ylabel('Drag force per unit length (N/mm)')
xlim auto
xticks([1:2:17])
set(gca,'FontSize',14)
legend("OpenFAST","In-house code")